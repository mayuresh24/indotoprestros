<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  padding: 20px;
}
input, button {
  padding: 10px;
  margin: 5px 0;
}
table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #334155;
  padding: 8px;
  font-size: 14px;
}
th {
  background: #1e293b;
}
</style>
</head>

<body>

<h2>üîê Admin Login</h2>

<input type="password" id="adminPass" placeholder="Enter Admin Password">
<button id="loginBtn">Login</button>

<div id="content" style="display:none;">
  <h2>üìç Location Data</h2>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Lat</th>
        <th>Lon</th>
        <th>Accuracy</th>
        <th>City</th>
        <th>State</th>
        <th>Country</th>
        <th>Postal</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">

  // Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, where } 
  from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_NEW_API_KEY",
    authDomain: "sample-4d3c3.firebaseapp.com",
    projectId: "sample-4d3c3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // DOM
  const loginBtn = document.getElementById("loginBtn");
  const adminPass = document.getElementById("adminPass");
  const tableBody = document.querySelector("#dataTable tbody");

  loginBtn.addEventListener("click", async () => {
    const pass = adminPass.value.trim();

    if (pass !== "desh21mayu50") {
      alert("Wrong password!");
      return;
    }

    document.getElementById("content").style.display = "block";

    // READ FIRESTORE WITH PASSWORD
    const q = query(
      collection(db, "locations"),
      where("__name__", "!=", "") // required dummy filter
    );

    const url = `https://firestore.googleapis.com/v1/projects/sample-4d3c3/databases/(default)/documents/locations?password=${pass}`;

    // Fetch using REST API (required because rules use request.query.password)
    const res = await fetch(url);
    const json = await res.json();

    console.log("Admin Data:", json);

    tableBody.innerHTML = "";

    if (!json.documents) {
      tableBody.innerHTML = "<tr><td colspan='8'>No data found</td></tr>";
      return;
    }

    json.documents.forEach(doc => {
      const d = doc.fields;
      tableBody.innerHTML += `
        <tr>
          <td>${d.timestamp.stringValue}</td>
          <td>${d.lat.doubleValue}</td>
          <td>${d.lon.doubleValue}</td>
          <td>${d.accuracy.doubleValue}</td>
          <td>${d.city.stringValue || ""}</td>
          <td>${d.state.stringValue || ""}</td>
          <td>${d.country.stringValue || ""}</td>
          <td>${d.postal_code.stringValue || ""}</td>
        </tr>`;
    });

  });

</script>

</body>
</html>
