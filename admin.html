<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin Dashboard</title>
<style>
  body {
    background: #0f172a;
    color: white;
    font-family: Arial;
    padding: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #334155;
    padding: 10px;
  }
  th {
    background: #1e293b;
  }
  tr:nth-child(even) {
    background: #1e293b;
  }
</style>
</head>
<body>

<h2>üìç Admin Dashboard ‚Äì Locations</h2>
<table id="dataTable">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Accuracy</th>
      <th>City</th>
      <th>State</th>
      <th>Country</th>
      <th>Address</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_KEY = "AIzaSyDZv4ZTHqpFmDyQGFi4v-gCShkGnBplrXc";

// Helper to safely extract Firestore fields
function getField(f) {
  if (!f) return "";
  if (f.stringValue !== undefined) return f.stringValue;
  if (f.doubleValue !== undefined) return f.doubleValue;
  if (f.integerValue !== undefined) return Number(f.integerValue);
  if (f.mapValue !== undefined) return "[map]";
  return "";
}

async function loadData() {
  const url = `https://firestore.googleapis.com/v1/projects/sample-4d3c3/databases/(default)/documents/locations?key=${API_KEY}`;

  const res = await fetch(url);
  const json = await res.json();

  console.log("ADMIN DATA RAW:", json.documents);

  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";

  json.documents.forEach(doc => {
    const f = doc.fields;

    const lat = getField(f.lat);
    const lon = getField(f.lon);
    const accuracy = getField(f.accuracy);
    const ts = getField(f.timestamp);
    const city = getField(f.city);
    const state = getField(f.state);
    const country = getField(f.country);
    const addr = getField(f.formatted_address);

    const readableTS = ts ? new Date(ts).toLocaleString() : "-";

    const row = `
      <tr>
        <td>${readableTS}</td>
        <td>${lat}</td>
        <td>${lon}</td>
        <td>${accuracy}</td>
        <td>${city}</td>
        <td>${state}</td>
        <td>${country}</td>
        <td>${addr}</td>
      </tr>
    `;

    tbody.innerHTML += row;
  });
}

loadData();
</script>

</body>
</html>
