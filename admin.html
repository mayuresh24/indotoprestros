<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table, th, td { border: 1px solid #555; }
    th, td { padding: 10px; text-align: left; }
    input { padding: 10px; width: 220px; }
    button { padding: 10px 16px; }
  </style>
</head>

<body>

<h2>Admin Login</h2>

<input type="password" id="pass" placeholder="Enter Password">
<button id="loginBtn">Login</button>

<div id="adminPanel" style="display:none;">
  <h2>üìç Locations Collected</h2>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>Accuracy</th>
        <th>City</th>
        <th>State</th>
        <th>Country</th>
        <th>Postal</th>
        <th>Address</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const PASSWORD = "desh21mayu50";
const API_KEY = "YOUR_RESTRICTED_FIRESTORE_KEY"; // Add restricted API key here
const PROJECT_ID = "sample-4d3c3";

document.getElementById("loginBtn").addEventListener("click", async () => {
  const input = document.getElementById("pass").value;
  if (input !== PASSWORD) {
    alert("Incorrect Password");
    return;
  }

  document.getElementById("adminPanel").style.display = "block";

  // ‚úì Call REST API (firestore batchGet)
  const url =
    `https://firestore.googleapis.com/v1/projects/${PROJECT_ID}/databases/(default)/documents:batchGet?key=${API_KEY}`;

  const body = {
    documents: ["projects/" + PROJECT_ID + "/databases/(default)/documents/locations"]
  };

  const res = await fetch(url, {
    method: "POST",
    body: JSON.stringify(body)
  });

  const raw = await res.json();
  console.log("ADMIN DATA RAW:", raw);

  let tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";

  raw.forEach(entry => {
    if (!entry.found) return; // Skip missing

    let f = entry.found.fields;

    let row = `
      <tr>
        <td>${f.lat?.doubleValue || ""}</td>
        <td>${f.lon?.doubleValue || ""}</td>
        <td>${f.accuracy?.doubleValue || ""}</td>
        <td>${f.city?.stringValue || ""}</td>
        <td>${f.state?.stringValue || ""}</td>
        <td>${f.country?.stringValue || ""}</td>
        <td>${f.postal_code?.stringValue || ""}</td>
        <td>${f.formatted_address?.stringValue || ""}</td>
        <td>${f.timestamp?.stringValue || ""}</td>
      </tr>
    `;
    tbody.innerHTML += row;
  });

});
</script>

</body>
</html>
